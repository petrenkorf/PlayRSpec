name: Docker Image CI 

on:
  push:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Build Docker Image
        run: |
          docker build -t ruby-wasm-builder .

      - name: Start container
        run: | 
          docker create --name rbwasm-temp ruby-wasm-builder

      - name: Copy WASM file
        run: |
          docker cp rbwasm-temp:/app/base.wasm .

      - name: Remove container 
        run: |
          docker rm rbwasm-temp

      - name: Check if build exists
        run: | 
          [ -f "./base.wasm" ] || { echo "Error: base.wasm not found"; exit 1; }

      - name: Copy Wasm File
        run: |
          mv ./base.wasm public/

      - name: Install dependencies
        run: |
          npm ci

      - name: Build React app
        run: |
          npm run build
